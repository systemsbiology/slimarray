<div id="sample_fields">
  <% @n = 1 %>
  <% current_label ||= @chip_type.platform.default_label %>

  <% @layout.each do |section| %>
    <% if section[:title] %>
      <h3><%=h section[:title] %><h3/>
    <% end %>

    <table id="table" class="nonsortable" cellpadding="0" cellspacing="0" border="0">
      <thead>
        <tr>
          <th></th>
          <th>Name on the sample tube</th>
          <% if @naming_scheme %>
            <% for element in @naming_elements %>
              <th><%=h element.name %></th>
            <% end %>
          <% else %>
            <th>Sample Description</th>
            <th>Sample Group</th>
          <% end %>
          <% if @chip_type.platform.multiple_labels %>
            <th>Label</th>
          <% end %>
          <th>Organism</th>
          <th>Chip Type</th>
        </tr>
      </thead>
      <% section[:samples].each do |sample_info| %>
        <% @n_padded = "%04d" % @n %>

        <tr>
          <td><%= sample_info[:title] %></td>
          <td><%= text_field 'sample_set[samples]', :name_on_tube, :size => 10, :index => @n_padded, :class => "required" %></td>
          <% if @naming_scheme == nil %>
            <td><%= text_field "sample_set[samples][#{@n_padded}]", :sample_name, :size => 30, :class => "required sample_description" %></td>
            <td><%= text_field "sample_set[samples][#{@n_padded}]", :sample_group_name, :size => 30 %></td>
          <% else %>
            <% @sample = Sample.new(:naming_scheme_id => @naming_scheme.id) %>
            <%= render :partial => 'samples/schemed_sample_description', :locals => { 
              :field_prefix => "sample_set[samples][#{@n_padded}]" } %>
          <% end %>
          
          <% if @chip_type.platform.multiple_labels %>
            <td><%= collection_select "sample_set[samples][#{@n_padded}]", :label_id, @labels,
              :id, :name, {:prompt => true, :selected => current_label.id} %></td>

            <% if @service_option.channels > 1 %>
              <% current_label = current_label.match_label %>
            <% end %>
          <% end %>

          <td><%= collection_select "sample_set[samples][#{@n_padded}]", :organism_id, @organisms,
            :id, :name, {:prompt => true, :selected => @chip_type.organism_id} %></td>
          
          <td><%=h @chip_type.name %></td>
          <%= hidden_field "sample_set[samples][#{@n_padded}]", :slide, :value => sample_info[:slide] %></td>
          <%= hidden_field "sample_set[samples][#{@n_padded}]", :array, :value => sample_info[:array] %></td>
          <%= hidden_field "sample_set[samples][#{@n_padded}]", :channel, :value => sample_info[:channel] %></td>
        </tr>
        <% @n += 1 %>
      <% end %>
    </table>
  <% end %>

</div>

<script type="text/javascript">
  $.validator.addClassRules('sample_description', {
    noSpaces: true
  });
</script>
